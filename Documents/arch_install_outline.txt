    Installation of Arch Linux with Plasma and/or Gnome
    ===================================================

Pre-installation
----------------

Download the iso from <https://www.archlinux.org/download/>

Verify the signature:
    gpg --keyserver-options auto-key-retrieve --verify archlinux-version-x86_64.iso.sig

Alternatively, from an existing Arch Linux installation run:
    pacman-key -v archlinux-version-x86_64.iso.sig

Write to USB
------------

Insert USB drive and discover the device with:
    lsblk

Write to USB drive
    dd if=archlinux<version>x86_64.iso of=/dev/sdX bs=4M status=progress && sync
Where /dev/sdX was obtained from the 'lsblk' command above.

Boot the Live Environment
-------------------------

Insert the USB stick and boot until archroot prompt is displayed.

Keyboard Layout
---------------

For non US keyboards the configuration needs changing:
    loadkeys uk
Works for UK PC keyboards.

To obtain a list of all keyboard layouts:
    ls /usr/share/kbd/keymaps/**/*.map.gz

If the font is not suitable then 'setfont' can be used:
    setfont /usr/share/kbd/consolefonts/iso01-12x22.psfu.gz

Internet
--------

Check for connection with:
    ip a

For wifi:
    wifi-menu

Time
----

    timedatectl set-ntp true

Check the service status:
    timedatectl status

Disks
-----

Check partitions with:
    lsblk -o model,type,name,fstype,size,label,mountpoint,partlabel
or
    lsblk -o +fstype,label

Create partitions with 'fdisk', 'gdisk', 'cfdisk' or 'cgdisk'.

Format partitions
-----------------

EFI partition
NOTE!!! Not to be performed if efi partition exists. All data will be lost.
    mkfs.fat -F32 /dev/sdX

Root partition:
    mkfs.ext4 /dev/sdY

Home and /usr/local partitions:
Only format these partitions as ext4 if they are being newly created. Do not
format if using existing partitions

Mount partitions
----------------

Root partition:
    mount /dev/sdX /mnt

Home partition:
    mkdir /mnt/home
    mount /dev/sdX /mnt/home

/usr/local partition:
    mkdir -p /mnt/usr/local
    mount /dev/sdX /mnt/usr/local

EFI partition:
    mkdir -p /mnt/boot/efi
    mount /dev/sdX /mnt/boot/efi

Install Base System
-------------------

Edit the /etc/pacman.d/mirrorlist file with vim and move United Kingdom servers
to the top.
    vim /etc/pacman.d/mirrorlist

Install basic software with:
    pacstrap /mnt base linux linux-firmware gvim neovim

Fstab
-----

Generate the /etc/fstab file:
    genfstab -U /mnt >> /mnt/etc/fstab

Check for correctness:
    cat /mnt/etc/fstab

Arch-root
---------

Log into the newly created system with:
    arch-chroot /mnt

Swap (optional)
---------------

Create swap file:
    fallocate -l 2GB /swapfile
    chmod 600 /swapfile
    mkswap /swapfile
    swapon /swapfile

Edit /etc/fstab and append with:
    /swapfile none swap 0 0

Time
----

Set timezone:
    ln -sf /usr/share/zoneinfo/Europe/London /etc/localtime

Synchronise system and harware clocks:
    hwclock --systohc --localtime

Locales
-------

Edit /etc/locale.gen
    vi /etc/locale.gen
Search for en_GB and uncomment the lines that contain it.

Generate locale:
    locale-gen

Edit /etc/locale.conf
    vi /etc/locale.conf
Insert line
    LANG=en_GB.UTF-8

Internet
--------

Hostname
--------

Edit /etc/hostname
    vi /etc/hostname
Insert \<hostname> of your choice.


Hosts
-----

Edit /etc/hosts
    vi /etc/hosts
Enter the following lines into the file:
    127.0.0.1	localhost
    ::1		localhost
    127.0.1.1	<hostname>.localdomain	<hostname>

Root password
-------------

Create root password
    passwd

Grub
----

Packages
--------

Install the following packages:
    pacman -S grub efibootmgr networkmanager network-manager-applet \
    wireless_tools wpa_supplicant dialog os-prober mtools dosfstools base devel \
    linux-headers intel-ucode
Note! wireless_tools and wpa_supplicant are only needed for machines with wi-fi.

Grub install
    grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=<boot-loader name>


Grub Configuration
    grub-mkconfig -o /boot/grub/grub.cfg

Exit Installation and unmount
-----------------------------

Exit the new install and re-enter arch boot by typing
    exit
or
    <CTRL-D>
at the command prompt.

Unmount new partitions
    umount -R /mnt
or
    umount -a
Will get error messages with second method.

Reboot
    reboot


New Installation
----------------

When rebooted into the new install

Internet
--------

Start Networkmanager
--------------------

Wired connection
    systemctl start NetworkManager
    systemctl enable NetworkManager
NOTE! Uppercase 'N' and 'M' in NetworkManager.

Wireless connection
    nmtui

Check Internet Connection
-------------------------

    ip a

Create User Accounts
--------------------

Create New User
    useradd -m -g users -G wheel <username>
    passwd <username>

Sudo
----

Sudo has now to be configured.
    visudo

Edit accordingly.

Graphics
--------

    pacman -S nvidia-dkms nvidia-utils nvidia-settings
    pacman -S xorg

Desktop Environments
--------------------

Plasma
------

    pacman -S sddm
    systemctl enable sddm

Install Plasma and applications
    pacman -S plasma kde-applications xdg-user-dirs packagekit-qt5

Gnome [optional]
----------------

Install and enable desktop manager gdm
    pacman -S gdm
    systemctl enable gdm

Install gnome desktop environment
    pacman -S gnome gnome-extra
NOTE! For gnome desktop install 'gnome' and 'gnome-extra' packages.
